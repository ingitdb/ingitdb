{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/ingitdb/ingitdb/schemas/ingitdb-collection.schema.json",
  "title": "inGitDB Collection Definition",
  "description": "Schema for the .ingitdb-collection.yaml file that defines an inGitDB collection, including its columns, record file format, and optional views.",
  "type": "object",
  "required": ["columns", "record_file"],
  "properties": {
    "titles": {
      "type": "object",
      "description": "Localized titles for the collection, keyed by locale code (e.g. 'en', 'de', 'fr').",
      "additionalProperties": {
        "type": "string"
      }
    },
    "record_file": {
      "$ref": "#/$defs/RecordFileDef"
    },
    "data_dir": {
      "type": "string",
      "description": "Optional relative path to the directory containing the collection's data files."
    },
    "columns": {
      "type": "object",
      "description": "A map of column IDs to their definitions. At least one column must be defined.",
      "minProperties": 1,
      "additionalProperties": {
        "$ref": "#/$defs/ColumnDef"
      }
    },
    "columns_order": {
      "type": "array",
      "description": "An ordered list of column IDs defining the display order. Each entry must reference a column defined in 'columns'. Duplicates are not allowed.",
      "items": {
        "type": "string"
      },
      "uniqueItems": true
    },
    "default_view": {
      "type": "string",
      "description": "The ID of the default view to use for this collection."
    }
  },
  "additionalProperties": false,
  "$defs": {
    "RecordFileDef": {
      "type": "object",
      "title": "Record File Definition",
      "description": "Defines how records are stored in files — including the file naming pattern, serialization format, and whether the file contains a single record, a list, or a map.",
      "required": ["name", "format", "type"],
      "properties": {
        "name": {
          "type": "string",
          "description": "File name pattern for record files. Supports placeholders: '{key}' is replaced with the record key, '{column_name}' is replaced with the value of that column.",
          "minLength": 1,
          "examples": [
            "{key}.json",
            "{key}.yaml",
            "records.json",
            "data.yaml"
          ]
        },
        "format": {
          "type": "string",
          "description": "The serialization format of the record file (e.g. 'JSON', 'YAML').",
          "minLength": 1,
          "examples": ["JSON", "YAML"]
        },
        "type": {
          "type": "string",
          "title": "Record Type",
          "description": "Defines how records are stored within the file.",
          "enum": [
            "map[string]any",
            "[]map[string]any",
            "map[string]map[string]any"
          ],
          "x-enum-descriptions": {
            "map[string]any": "Single record per file — each record is stored as a key-value map in its own file.",
            "[]map[string]any": "List of records — multiple records stored as an ordered array in a single file.",
            "map[string]map[string]any": "Dictionary of records — multiple records stored as a keyed map in a single file."
          }
        }
      },
      "additionalProperties": false
    },
    "ColumnDef": {
      "type": "object",
      "title": "Column Definition",
      "description": "Defines the schema for a single column in a collection.",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "title": "Column Type",
          "description": "The data type of the column. Can be a primitive type, a localization map, or a generic map type like 'map[keyType]valueType'.",
          "anyOf": [
            {
              "enum": [
                "string",
                "int",
                "float",
                "bool",
                "date",
                "time",
                "datetime",
                "any",
                "map[locale]string"
              ]
            },
            {
              "type": "string",
              "pattern": "^map\\[(locale|string|int|number|bool|date)\\].+$",
              "description": "A map type with a supported key type. Format: 'map[keyType]valueType' where keyType is one of: locale, string, int, number, bool, date."
            }
          ]
        },
        "title": {
          "type": "string",
          "description": "A display title for the column (single locale)."
        },
        "titles": {
          "type": "object",
          "description": "Localized column titles, keyed by locale code.",
          "additionalProperties": {
            "type": "string"
          }
        },
        "valueTitle": {
          "type": "string",
          "description": "A display title for the column's value."
        },
        "required": {
          "type": "boolean",
          "description": "Whether a value for this column is required. Defaults to false.",
          "default": false
        },
        "length": {
          "type": "integer",
          "description": "Exact required length for the column value.",
          "minimum": 0
        },
        "min_length": {
          "type": "integer",
          "description": "Minimum length for the column value.",
          "minimum": 0
        },
        "max_length": {
          "type": "integer",
          "description": "Maximum length for the column value.",
          "minimum": 0
        },
        "foreign_key": {
          "type": "string",
          "description": "A reference to another collection, expressed as a dot-separated path (e.g. 'auth.users')."
        }
      },
      "additionalProperties": false
    }
  }
}
